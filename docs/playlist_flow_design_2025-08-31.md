🎯 ゴール（MVP）

「DJ特徴／番組名＆概要／曲数or長さ → AI膨らまし → テーマ解釈 → セットリスト（曲名＋理由） → Spotifyにプレイリスト生成 → ページ表示」まで一発で通す。

🧭 ユーザーフロー（画面）

入力フォーム

DJ特徴（自由文）

番組名／概要

曲数 or 番組の長さ（どちらか必須）

送信ボタン「番組をつくる」

結果ページ

① DJ膨らまし（短いプロフィール）

② テーマ解釈（厚め、150–250字）

③ セットリスト（曲順・曲名—アーティスト・各曲ひとこと理由）

④ 番組まとめ（80–120字）

「Spotifyで開く」ボタン（生成プレイリスト）
※今回は“その場の微調整”はナシ

🔗 システムフロー（バックエンド）

Frontend → API(A) → API(B) → API(C) → Spotify → 結果整形

API(A): DJ膨らまし
入力：DJ自由文
出力：

background（1–2文）

taste/傾向（箇条書き）

避けがち（任意・1行）

キャラ色の強弱（内部用メモ程度）

API(B): テーマ解釈
入力：番組名・概要＋(A)の出力＋曲数/長さ情報
出力：150–250字の厚めの解釈文（“なぜそう解釈するか”も含む）

API(C): セットリスト生成
入力：解釈文＋曲数/長さ＋（任意で）目安BPM/ムード
出力：

曲順の曲名—アーティスト（曲数ぶん）

各曲のひとこと理由（DJの視点で1行）

（任意）ざっくり合計尺見込み

Spotify段

(C)の固有名で検索→照合→見つかった曲のみでプレイリスト生成

見つからない曲は静かにスキップ（今回は代替再提案なし）

プレイリストURI/URLを取得

表示

①〜④のテキストをそのまま

リンクボタンでSpotifyへ

リダイレクトURIは127.0.0.1:3000前提で固定（メモ継続）

📝 プロンプト設計（文章型・最小）

Pass A（DJ膨らまし）

指示：自由文を読んで、選曲の芯に関わる要点だけ短く出す。

形式：

背景（1–2文）

好む傾向（3点以内の箇条書き）

避けがち（あれば1点）

一言のキャラメモ（内部用）

Pass B（テーマ解釈）

指示：このDJなら今回の番組テーマをどう捉えるか。理由付きで150–250字。

ねらい：テーマ外れ／凡庸回避のガードレール。

Pass C（セットリスト）

指示：解釈に沿って、曲名—アーティストを曲順で。各曲に1行の理由。

注意：実在が怪しい固有名は出さない／曖昧なら“候補A/B”表記OK。

意外性：AIに任せる（入れても入れなくてもよい。入れるなら理由を添える）

🔍 Spotify照合（最小）

検索クエリ：artist:"<Artist>" track:"<Title>" を基本

タイトル正規化：括弧、- remaster/live/acoustic の除去

一致条件（簡易）：

タイトル厳密一致 or 前方一致

アーティスト厳密一致（feat./&/withを許容）

失敗時：今回はスキップ（代替はやらない）

成功した曲だけ順に追加 → プレイリスト作成

⚖️ 受け入れ基準（このMVPで確認したいこと）

テーマから外れていない（解釈文どおりの空気）

キャラの色が自然に滲む（1–2曲でわかる）

明らかな場違い曲が混入しない

Spotifyプレイリストが作成できる（リンク動作OK）

スキップが出ても全体として成立（曲数が極端に減らない）

🧪 テスト観点（紙上→実機）

同一テーマで複数キャラ（今回の3人でOK）

同一キャラで別テーマ（例：雨の日、冬の朝）

曲数指定／長さ指定の両方

見つからない曲が出た時でもページが破綻しない（「X曲で構成」表示）

➕ 先送り（MVP後に足す）

曲ごとの事実ベース解説（曲/アーティスト情報）

代替候補の自動提示（不在時）

「理論派／雰囲気派」などスタイルの可視化（★）

その場の微調整UI（今回は入れない）